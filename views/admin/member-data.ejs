<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Member Data</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
      <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

</head>
<body class="bg-gray-100 font-sans">

  <!-- HEADER -->
  <header class="bg-[#002d6b] text-white px-8 py-4 flex justify-between items-center">
    <div class="flex items-center gap-4">
      <img src="" alt="logo" class="w-10">
      <h1 class="text-xl font-bold tracking-wide">WEB PORTAL</h1>
    </div>
    <div class="flex items-center gap-2">
      <span>Hi, <%= user.username %></span>
      <i class="fa-solid fa-user-tie text-2xl"></i>
    </div>
  </header>

  <!-- NAV -->
  <nav class="bg-gray-200 px-8 py-3 flex gap-4 text-sm font-medium">
    <a href="/" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Main Page</a>
    <a href="/dashboard-admin" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Dashboard</a>
    <a href="/member-data" class="px-4 py-2 rounded bg-blue-200 font-bold">Member Data</a>
    <a href="/submit-case" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Submit Case</a>
    <a class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Report</a>
  </nav>

  <main class="px-8 py-6">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-bold mb-4">Member Data</h2>

      <!-- Upload CSV -->
      <form action="/member-data/upload" method="POST" enctype="multipart/form-data" class="flex items-center gap-2">
        <input type="file" name="csvfile" accept=".csv" required class="p-2 border rounded bg-white"/>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Upload CSV</button>
      </form>
    </div>

    <!-- OPTIONAL: small help text / expected csv columns -->
    <p class="text-sm text-gray-600 mb-4">Format CSV minimal: <code>nik,bpjs,nama,tgl_lahir,nama_produk,nomor_polis,issued_date</code></p>

    <!-- TABLE -->
    <div class="overflow-x-auto bg-white rounded shadow">
      <table class="w-full text-sm">
        <thead class="bg-gray-300 text-gray-700">
          <tr>
            <th class="p-3 text-left">NIK</th>
            <th class="p-3 text-left">No BPJS</th>
            <th class="p-3 text-left">Nama</th>
            <th class="p-3 text-left">Tgl Lahir</th>
            <th class="p-3 text-left">Usia</th>
            <th class="p-3 text-left">Nama Produk</th>
            <th class="p-3 text-left">No Polis</th>
            <th class="p-3 text-left">Issued Date</th>
          </tr>
        </thead>

        <tbody>
          <% if (!members || members.length === 0) { %>
            <tr>
              <td class="p-3 border" colspan="8">Belum ada data member.</td>
            </tr>
          <% } else { %>
            <% members.forEach(m => { 
                 const dob = m.tgl_lahir ? new Date(m.tgl_lahir) : null;
                 const usia = dob ? Math.floor((Date.now() - dob.getTime()) / 31557600000) : '-';
            %>
            <tr class="odd:bg-gray-50">
              <td class="p-3 border"><%= m.nik %></td>
              <td class="p-3 border"><%= m.bpjs || '-' %></td>
              <td class="p-3 border"><%= m.nama %></td>
              <td class="p-3 border"><%= m.tgl_lahir ? (new Date(m.tgl_lahir)).toLocaleDateString() : '-' %></td>
              <td class="p-3 border"><%= usia %></td>
              <td class="p-3 border"><%= m.nama_produk || '-' %></td>
              <td class="p-3 border"><%= m.nomor_polis || '-' %></td>
              <td class="p-3 border"><%= m.issued_date ? (new Date(m.issued_date)).toLocaleDateString() : '-' %></td>
            </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </main>
  <script>
        (function(){
            const urlParams = new URLSearchParams(window.location.search);
            const UploadParam = urlParams.get('upload');
            if (!UploadParam) return; // only show an alert when the param exists

            if (UploadParam === 'success') {
                swal({
                    title: 'Upload Success',
                    text: 'You have successfully logged in',
                    icon: 'success',
                    button: 'OK'
                });
            } else {
                swal({
                    title: 'Upload Failed',
                    text: 'Invalid username or password',
                    icon: 'error',
                    button: 'OK'
                });
            }
        })();
    </script>
</body>
</html>
